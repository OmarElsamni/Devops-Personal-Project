# Jenkins Configuration as Code (JCasC)
# Place this in /var/jenkins_home/casc_configs/jenkins.yaml

jenkins:
  systemMessage: "DevOps Task Manager - CI/CD Pipeline"
  numExecutors: 2
  mode: NORMAL
  
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "admin"
          password: "admin123"  # Change this!
  
  authorizationStrategy:
    globalMatrix:
      permissions:
        - "Overall/Administer:admin"
        - "Overall/Read:authenticated"
  
  clouds:
    - kubernetes:
        name: "kubernetes"
        serverUrl: "https://kubernetes.default"
        namespace: "jenkins"
        jenkinsUrl: "http://jenkins.jenkins.svc.cluster.local"
        jenkinsTunnel: "jenkins.jenkins.svc.cluster.local:50000"
        containerCapStr: "10"
        maxRequestsPerHostStr: "32"
        retentionTimeout: 5
        connectTimeout: 10
        readTimeout: 20
        
        templates:
          - name: "jenkins-agent"
            namespace: "jenkins"
            label: "jenkins-agent"
            nodeUsageMode: NORMAL
            containers:
              - name: "jnlp"
                image: "jenkins/inbound-agent:latest"
                alwaysPullImage: true
                workingDir: "/home/jenkins/agent"
                ttyEnabled: true
                resourceRequestCpu: "500m"
                resourceRequestMemory: "512Mi"
                resourceLimitCpu: "1000m"
                resourceLimitMemory: "1Gi"

credentials:
  system:
    domainCredentials:
      - credentials:
          - usernamePassword:
              scope: GLOBAL
              id: "github-credentials"
              username: "YOUR_GITHUB_USERNAME"
              password: "YOUR_GITHUB_TOKEN"
              description: "GitHub credentials"
          
          - string:
              scope: GLOBAL
              id: "aws-account-id"
              secret: "YOUR_AWS_ACCOUNT_ID"
              description: "AWS Account ID"
          
          - aws:
              scope: GLOBAL
              id: "aws-credentials"
              accessKey: "YOUR_AWS_ACCESS_KEY"
              secretKey: "YOUR_AWS_SECRET_KEY"
              description: "AWS Credentials"

jobs:
  - script: >
      pipelineJob('task-manager-pipeline') {
        definition {
          cpsScm {
            scm {
              git {
                remote {
                  url('https://github.com/YOUR_USERNAME/YOUR_REPO.git')
                  credentials('github-credentials')
                }
                branch('*/main')
              }
            }
            scriptPath('Jenkinsfile')
          }
        }
        triggers {
          githubPush()
        }
      }

unclassified:
  location:
    url: "http://jenkins.example.com/jenkins"
  
  globalLibraries:
    libraries:
      - name: "shared-library"
        defaultVersion: "main"
        retriever:
          modernSCM:
            scm:
              git:
                remote: "https://github.com/YOUR_ORG/jenkins-shared-library.git"

